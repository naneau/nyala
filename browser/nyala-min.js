(function(){var a,b,c,d,e,f=Array.prototype.slice,g=function(a,b){return function(){return a.apply(b,arguments)}},h=Object.prototype.hasOwnProperty,i=function(a,b){function d(){this.constructor=a}for(var c in b)h.call(b,c)&&(a[c]=b[c]);d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype;return a};e=function(a,b){return(typeof module!="undefined"&&module!==null?module.exports:void 0)!=null?module.exports[a]=b:window[a]=b},a=function(){function a(){var a;a=1<=arguments.length?f.call(arguments,0):[];if(a.length===0)throw new Error("No function passed to Promise");this.scope=a.length>=2?a[1]:this,this.func=a[0],this.brokenHandlers=[],this.keptHandlers=[],void 0}a.prototype.kept=function(a){this.keptHandlers.push(a);return this},a.prototype.broken=function(a){this.brokenHandlers.push(a);return this},a.prototype.execute=function(){var a;a=1<=arguments.length?f.call(arguments,0):[];if(this.assert!=null&&!this.assert.apply(this,a))return this["break"]("Assertion failed");a.push(g(function(){a=1<=arguments.length?f.call(arguments,0):[];return this.keep.apply(this,a)},this)),a.push(g(function(){a=1<=arguments.length?f.call(arguments,0):[];return this["break"].apply(this,a)},this));return this.func.apply(this.scope,a)},a.prototype["break"]=function(){var a,b,c,d,e,g;a=1<=arguments.length?f.call(arguments,0):[],e=this.brokenHandlers,g=[];for(c=0,d=e.length;c<d;c++)b=e[c],g.push(b.apply(null,a));return g},a.prototype.keep=function(){var a,b,c,d,e,g;a=1<=arguments.length?f.call(arguments,0):[],this.filter&&(a=this.filter.apply(this,a)),Array.isArray(a)||(a=[a]),e=this.keptHandlers,g=[];for(c=0,d=e.length;c<d;c++)b=e[c],g.push(b.apply(null,a));return g};return a}(),e("Promise",a),b=function(){function b(){var a,c,d,e;a=1<=arguments.length?f.call(arguments,0):[],b.__super__.constructor.call(this,g(function(){var a;a=1<=arguments.length?f.call(arguments,0):[];if(this.promises.length===0)return this.keep();return this.runStack.apply(this,a)},this)),this.promises=[],this.setUpPromises=[];for(d=0,e=a.length;d<e;d++)c=a[d],this.add(c);void 0}i(b,a),b.prototype.add=function(){var b,c;b=1<=arguments.length?f.call(arguments,0):[],typeof b[0]=="function"?c=function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return typeof e=="object"?e:d}(a,b,function(){}):c=b[0],this.promises.push(c);return this},b.prototype.promiseIsSetUp=function(a){var b;return function(){var c,d,e,f;e=this.setUpPromises,f=[];for(c=0,d=e.length;c<d;c++)b=e[c],b===a&&f.push(b);return f}.call(this).length>0},b.prototype.addSetUpPromise=function(a){return this.setUpPromises.push(a)},b.prototype.runStack=function(){var a,b,c,d;a=3<=arguments.length?f.call(arguments,0,d=arguments.length-2):(d=0,[]),c=arguments[d++],b=arguments[d++]};return b}(),c=function(){function a(){a.__super__.constructor.apply(this,arguments)}i(a,b),a.prototype.runStack=function(){var a,b,c,d,e,h,i,j,k,l,m;a=3<=arguments.length?f.call(arguments,0,i=arguments.length-2):(i=0,[]),c=arguments[i++],b=arguments[i++],e=[],d=g(function(a){var b;if(function(){var c,d,f;f=[];for(c=0,d=e.length;c<d;c++)b=e[c],b===a&&f.push(b);return f}().length>0)throw new Error("A promise was kept more than once");e.push(a);if(e.length===this.promises.length)return this.keep()},this),l=this.promises,m=[];for(j=0,k=l.length;j<k;j++)h=l[j],m.push(g(function(b){this.promiseIsSetUp(b)||(b.kept(function(){var a;a=1<=arguments.length?f.call(arguments,0):[];return d(b)}),b.broken(g(function(){var a;a=1<=arguments.length?f.call(arguments,0):[];return this["break"].apply(this,a)},this)),this.addSetUpPromise(b));return b.execute.apply(b,a)},this)(h));return m};return a}(),e("PromiseBurst",c),d=function(){function a(){a.__super__.constructor.apply(this,arguments)}i(a,b),a.prototype.runStack=function(){var a,b,c,d,e;a=3<=arguments.length?f.call(arguments,0,e=arguments.length-2):(e=0,[]),c=arguments[e++],b=arguments[e++],d=g(function(){var b,c;b=arguments[0],a=2<=arguments.length?f.call(arguments,1):[];if(this.promises[b]==null)return this.keep.apply(this,a);c=this.promises[b],this.promiseIsSetUp(c)||(c.broken(g(function(){var a;a=1<=arguments.length?f.call(arguments,0):[];return this["break"].apply(this,a)},this)),c.kept(function(){var a;a=1<=arguments.length?f.call(arguments,0):[];return d.apply(null,[b+1].concat(f.call(a)))}),this.addSetUpPromise(c));if(this.assertEach!=null&&!this.assertEach.apply(this,a))return this["break"]("Assertion failed on step "+(b+1));return c.execute.apply(c,a)},this);return d.apply(null,[0].concat(f.call(a)))};return a}(),e("PromiseChain",d)}).call(this)